<!DOCTYPE html>
<html >
<head>
    <link rel="stylesheet" href="map.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
    integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
    crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
    integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
    crossorigin="">
    </script>

</head>

<body>

 <div id = "map"> </div>

</body>

<script>

let usersLat;
let usersLong;
var map = L.map('map').setView([38.2466, 21.7346], 15);

L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
}).addTo(map);

if ('geolocation' in navigator){
    console.log("available");
    navigator.geolocation.getCurrentPosition(function(position){
        usersLat = position.coords.latitude
        usersLong = position.coords.longitude
        console.log(usersLat);
        console.log(usersLong);
        var marker = L.marker([usersLat, usersLong]).addTo(map);
        map.setView([usersLat, usersLong], 15);
    })
}
else{
    console.log("not available");

}


fetch('/api/markers')
.then(response => response.json())
.then(data =>{
    console.log(data); 
    for(i=0; i < data.length; i++)
    {   
        var marker =  L.marker([data[i].lat,data[i].lon]).addTo(map);
        marker.bindPopup(data[i].tags.name).openPopup();
        // var popup = marker.popup()
        //         .setLatLng([data[i].lat, data[i].lon])
        //         .setContent(data[i].name)
        //         .openOn(map);
    }
   
    
})



</script>



</html>